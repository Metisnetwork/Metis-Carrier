syntax = "proto3";

package rpcapi;

option go_package = "github.com/RosettaFlow/Carrier-Go/lib/consensus/twopc";

import "lib/api/common_message.proto";
import "lib/api/metadata_rpc_api.proto";
import "lib/api/task_rpc_api.proto";

// 2pc prepare 阶段信息
message PrepareMsg {

  bytes           proposal_id = 1;            // 2pc 提案Id
  TaskOption      task_option = 2;            // 任务msg
  uint64          create_at = 3;              // proposal 创建的时间
  bytes           sign = 4;                   // 任务发起者签名

}

// 2pc prepareVote
message PrepareVote {

  bytes                             proposal_id = 1;            // 2pc 提案Id
  string                            task_role = 2;              // The role information of the current recipient of the task
  OrganizationIdentityInfo          owner = 3;                  // 投票人信息
  string                            vote_option = 4;            // 投票意见 (yes: 同意; no: 否决; abstention: 弃权)
  TaskPeerInfo                      peer_info = 5;              // 投票yes时, 对任务提供的自身资源 ip:port
  uint64                            create_at = 6;              // vote 创建的时间
  bytes                             sign = 7;                   // 投票发起者签名

}

// 2pc confirm 阶段信息
message ConfirmMsg {

  bytes                             proposal_id = 1;            // 2pc 提案Id

}

// 2pc confirmVote
message ConfirmVote {

  bytes                             proposal_id = 1;            // 2pc 提案Id

}

message TaskOption {

  string                                    task_role = 1;      // The role information of the current recipient of the task
  string                                    task_id = 2;
  string                                    task_name = 3;
  OrganizationIdentityInfo                  owner = 4;
  OrganizationIdentityInfo                  algo_supplier = 5;
  repeated DataSupplierOption               data_supplier = 6;
  repeated PowerSupplierOption              power_supplier = 7;
  repeated ReceiverOption                   receivers = 8;
  TaskOperationCostDeclare                  operation_cost = 9;
  string                                    calculate_contract_code = 10;
  string                                    datasplit_contract_code = 11;
  uint64                                    create_at = 12;

}

message DataSupplierOption {
  OrganizationIdentityInfo          member_info = 1;
  string                            meta_data_id = 2;
  repeated uint64                   column_index_list = 3;
}

message PowerSupplierOption {
  OrganizationIdentityInfo          member_info = 1;
}

message ReceiverOption {
  OrganizationIdentityInfo              member_info = 1;
  repeated OrganizationIdentityInfo     providers = 2;
}

message TaskPeerInfo {
  string            ip = 1;
  string            port = 2;
}


